<!DOCTYPE HTML>

<html lang="zh-CN">

	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
		<title>个人中心</title>
		<link rel="stylesheet" href="https://static.segmentfault.com/v-5b1918d6/global/css/global.css" />
		<link rel="stylesheet" href="https://static.segmentfault.com/v-5b1918d6/user/css/user.css" />
		<link rel="stylesheet" href="https://static.segmentfault.com/v-5b1918d6/global/css/responsive.css" />
		<script src="http://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
		<style>
			.academy_card{
				background: white;
				border: 1px solid gainsboro;
				width: 240px;
				height: 320px;
				margin-right: 20px;
				margin-top: 22px;
				float: left;
			}
			.academy_card .pic-box{
				width: 240px;
				height: 50%;
			}
			.ctx-box{
				width: 240px;
				height: 50%;
			}
			.academy_card .pic-box img{
				width: 100%;
				height: 100%;
			}
			.between-display{
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-top: 10px;
				padding: 0 10px;
			}
			.academy-name{
				font-size: 18px;
				color: green;
			}
			.aca-summary{
				font-size: 14px;
				max-height: 60%;
				min-height: 60%;
				display: -webkit-box;
				-webkit-box-orient: vertical;
				-webkit-line-clamp: 4;
				overflow: hidden;
			}
			@font-face {
				font-family:myfont;
				src: url('${pageContext.request.contextPath }/fonts/长城中楷体繁.TTF');
			}
			p {
				position: relative;
				line-height: 20px;
				max-height: 80px;
				font-family: myfont;
				overflow: hidden;
			}
			
			p::after {
				content: "...";
				font-family: myfont;
				position: absolute;
				bottom: 0;
				right: 0;
				padding-left: 40px;
				background: -webkit-linear-gradient(left, transparent, white 55%);
				background: -o-linear-gradient(right, transparent, white 55%);
				background: -moz-linear-gradient(right, transparent, white 55%);
				background: linear-gradient(to right, transparent, white 55%);
			}
			.ranking{
				font-family: myfont;
				font-size: 14px;
				color: #888;
			}
			.stress-rank{
				font-family: myfont;
				font-size: 24px;
				color: #F40;
			}
			.aca-star{
				width: 28px;
				height: 28px;
				color: gold;
			}
		</style>
	</head>

	<body data-mod="user" class="user-index ">
	
		<div class="global-nav sf-header sf-header--index" style="border-top: 3px solid #1787e0;">
			<div class="bottom-nav visible-xs visible-sm ">
				<div class="opts">
					<a class="opts-group " href="/"><i class="fa fa-home" aria-hidden="true"></i><span>首页</span></a>
					<a class="opts-group " href="/questions"><i class="fa fa-comments" aria-hidden="true"></i><span>问答</span></a>
					<a class="opts-group " href="/blogs"><i class="fa fa-pencil-square" aria-hidden="true"></i><span>专栏</span></a>
					<a class="opts-group " href="/lives"><i class="fa fa-play-circle" aria-hidden="true"></i><span>讲堂</span></a>
					
				</div>
			</div>
			<nav class="container nav">
				<div class="row hidden-xs hidden-sm" style="margin-left: -50px;">
					<div class="col-sm-8 col-md-9 col-lg-9">
						<div>
								<h1 style="margin: 10px 4px;"><a style="text-decoration: none;margin-bottom: 20px; color: #1787e0;" href="#">个人中心</a></h1>
						</div>
					</div>
				</div>
			</nav>
		</div>
	
		<div class="profile">
			<header class="profile__heading">
				<div class="container">
					<div class="row" style="position: relative;">
						<div class="col-md-2 col-sm-3 col-xs-3">
							<div class="profile__heading--avatar-warp">
								<a href="#">
									<img class=" profile__heading--avatar avatar-160" 
										src="img/头像.svg" 
										alt="八斤" />
								</a>
								<div class="profile__avatar-uploader"><span>上传头像</span></div>
							</div>

						</div>
						<div class="col-md-5 col-sm-9 col-xs-9">
							<h2 class="profile__heading--name">
								张三<small class="ml15"><a style="color:#1787e0"
                                            href="#">查看完整档案</a></small></h2>
							<div class="profile__heading--award">
								<a class="profile__rank-btn" href="#"
									style="color:#1787e0; border: 1px solid #1787e0;background: ghostwhite;">
									<span class="h4" style="color:#1787e0">1</span>
									<span class="profile__rank-btn-text" style="color:#1787e0">声望</span>
								</a>
								<div class="profile__heading--award-badge">
                                    <span class="sex profile__heading--award-badge-count">男</span>
								</div>
							</div>
							<div class="profile__heading--other">
								<span class="profile__heading--other-item "><i class="fa fa-map-marker"></i>
									<span class="profile__city">北京
										<span class="profile__heading-edit btn btn-xs" data-type="city">
											<i class="fa fa-pencil " aria-hidden="true"></i>编辑你的城市</span>
									</span>
								</span>
								<span class="profile__heading--other-item ">
									<i class="fa fa-graduation-cap" aria-hidden="true"></i>
									<span class="profile__school"><span id="expectAca">江西财经大学</span>
										<span class="profile__heading--other-item-fgx ">&nbsp;&nbsp;|&nbsp;&nbsp;</span>
										<span id="expectDep">软件工程</span>
										<span class="profile__heading-edit   btn btn-xs " data-type="school">
											<i class="fa fa-pencil " aria-hidden="true"></i>
											编辑你的意愿考研学校
										</span>
									</span>
								</span>
							</div>
						</div>
						<div class="profile__heading--desc col-md-5 col-sm-12 col-xs-12">
							<div class="profile__heading--desc-heading">
								<span class="profile__heading--desc-heading-dot-warp"></span>
								<span class="profile__heading-dot profile__heading-dot--red"></span>
								<span class="profile__heading-dot profile__heading-dot--yellow"></span>
								<span class="profile__heading-dot profile__heading-dot--green"></span>
								<div class="pull-right">
									<span data-type="desc" class="profile__heading-edit   btn btn-xs profile__heading--desc-heading-edit">
										<i class="fa fa-pencil" aria-hidden="true"></i>编辑签名
									</span></div>
							</div>
							<div class="profile__heading--desc-body">

								<div class="profile__desc">
									<p>开始编辑你的个性化签名吧</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</header>
			<div class="wrap mt30">
				<div class="container">
					<div class="row" style="display: flex; justify-content: space-between;">
						<div class="col-md-2">
							<div class="profile__heading-info row">
								<div class="col-md-6 col-xs-6" style="border-right: 1px solid #eee;">
									<a href="#"><span>关注了</span><span class="h5">17 人</span></a>
								</div>
								<div class="col-md-6 col-xs-6">
									<a href="#"><span>粉丝</span><span class="h5">0 人</span></a>
								</div>
							</div>

							<ul class="nav nav-pills nav-stacked profile__nav">
								<li role="separator" class="divider">
									<a></a>
								</li>
								<li class="active">
									<a href="#"><span>我的收藏夹
                                            </span><span class="count"> 29</span></a>
								</li>
								<li>
									<a href="#"><span>我的回答
                                        </span><span class="count"></span></a>
								</li>
								<li>
									<a href="#"><span>我的提问
                                        </span><span class="count"> 1</span></a>
								</li>
								<li>
									<a href="#"><span>我的笔记
                                        </span><span class="count"></span></a>
								</li>
								<li>
									<a href="#"><span>我的分享
                                        </span><span class="count"></span></a>
								</li>
								<li role="separator" class="divider">
									<a></a>
								</li>
								<li>
									<a href="#"><span>个人动态</span></a>
								</li>
								<li>
									<a href="#"><span>我关注的</span></a>
								</li>
								<li>
									<a href="#"><span>浏览记录</span></a>
								</li>
							</ul>

						</div>

						<div class="col-md-7">
							<div class="profile__init">
							</div>

							<div class="panel panel-default" style="width: 600px; ">
								<div class="panel-heading">
									<h3 class="panel-title inline">收藏详情</h3>
								</div>
								<div class="panel_body">
									<div class="profile__content" >
										<!-- Tab panes -->
										<div class="tab_content" id="tab_content" >
											<div class="academy_card" style="display: none;" >
												<div class="pic-box" >
													<img class="aca-img" src="img/jxufe.jpg" />
												</div>
												<div class="ctx-box">
													<div class="row-1 aca-title between-display">
														<span class="academy-name"><strong>江西财经大学</strong></span>
														<span>985/211</span>
													</div>
													<div class="row-2 aca-summary">
														<p>江西财经大学（Jiangxi University of Finance and Economics）坐落于英雄城南昌市，是一所财政部、教育部、江西省人民政府共建，以经济、管理类学科为主，法、工、文、理、农、教育、哲学、历史、艺术等学科协调发展的高等财经学府。2008年2月6日，时任国务院总理温家宝与学校师生共度除夕，并称赞说：“你们学校是所很好的学校”。江西省委书记鹿心社指出：“扎根红土地，培育栋梁材。江西财经大学为服务国家战略和地方经济社会发展做出了重大贡献”。</p>
													</div>
													<div class="row-3 aca-rank between-display" style="margin-top:0px">
														<div id="collectAca">
															<a class="star_link aca-star">取消收藏
															</a>
														</div>
													</div>
												</div>
											</div>
											
										</div>

									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>
		
	</body>

	<script>
		var param = getUrlParam("stuId");
		//		var param = 52;
		getPersonnalData(param);
		
		function getUrlParam(name) {  
		    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); // 构造一个含有目标参数的正则表达式对象  
		    var r = window.location.search.substr(1).match(reg);  // 匹配目标参数  
		    if (r != null) return unescape(r[2]); return null; // 返回参数值  
		} 
		
		//显示个人信息
		function getPersonnalData(stuId){
			$.ajax({
				type:"GET",
				url:"/PEE_assistant/studentInfoHanlder/getPersonalStudentInfo",
				//跨域请求，json格式前后端都要设置
				data:{
					"studentInfo_id":stuId
				},
				success:showPersonnalData
			}); 
		}
		
		function showPersonnalData(data){
			var name =  $(".profile__heading--name");
			name.text(data.stu_name);
			var sex = $(".sex");
			sex.text(data.stu_sex);
			var academy = $("#expectAca");
			academy.text(data.stu_academy)
			var expectDep = $("#expectDep");
			loadAcdemy(data.stu_Id);
		}
		
//		addAcademy_card(473,"西安交通大学",true,true,34);
		
		function loadAcdemy(studentId){
			$.ajax({
				type:"POST",
				url:"/PEE_assistant/CollectAcademyInfoHandler/fromCollectAcademyGetAcademyResult",
				contentType : "application/x-www-form-urlencoded",
				data:{
					"studentInfo_id":studentId
				},
				success:function(data){
					$(data).each(function(){
						addAcademy_card(this.aca_id,this.aca_name,this.aca_985,this.aca_211,this.aca_ranking);
					})
				}
			});
		}
		
		//显示收藏信息
		function addAcademy_card(aca_id,acaName,aca_985,aca_211,acaRank){
				var academy_card = document.getElementsByClassName("academy_card")[0];
				var tab_content = document.getElementById("tab_content");
				var new_academy_card= academy_card.cloneNode(true);
				new_academy_card.setAttribute("isNew","yes");
				
				new_academy_card.style.display = "block";
				new_academy_card.getElementsByClassName("academy-name")[0].innerHTML = "<strong>" + acaName +"</strong>";
				
				var aca_title = new_academy_card.getElementsByClassName("aca-title")[0];
				var acaProperty = aca_title.getElementsByTagName("span")[1];
				if(aca_211==true){
					acaProperty.innerHTML = "<strong style='color: purple;'>211</strong>";
					if(aca_985==true){
						acaProperty.innerHTML = "<strong style='color: red;'>985,211</strong>";
					}
				}else{
					acaProperty.innerHTML = "双非";
				}
				
				var aca_img = new_academy_card.getElementsByClassName("aca-img")[0];
				aca_img.src = "schoolImg/" + acaName + ".jpg";
				aca_img.alt = "抱歉，没有该高校的图片";

				var new_academy_card_a = document.createElement('a');
				
				var href = document.createAttribute("href");
				href.value = "/PEE_assistant/academyDetails.jsp?acaId=" + aca_id;
				new_academy_card_a.setAttributeNode(href);
				var aid = document.createAttribute("aid");
				aid.value = "a" + aca_id;
				new_academy_card_a.setAttributeNode(aid);
				new_academy_card.appendChild(new_academy_card_a);
				new_academy_card.setAttribute("aca_id",aca_id);
				tab_content.appendChild(new_academy_card);
				new_academy_card.addEventListener("click",function(){
					jump(aca_id);
				});
				
				/***小星星作用，取消作用*/
				var star = new_academy_card.getElementsByClassName("aca-star")[0];
				star.addEventListener("click",function(e){
					console.log(param);
					console.log(aca_id);
					 // 如果提供了事件对象，则这是一个非IE浏览器
				    if ( e && e.stopPropagation ) {
				        // 因此它支持W3C的stopPropagation()方法 
				        e.stopPropagation();
				    } else {
				        // 否则，我们需要使用IE的方式来取消事件冒泡
				        window.event.cancelBubble = true;
				    }
					$.ajax({
						type:"POST",
						url:"/PEE_assistant/CollectAcademyInfoHandler/cancelCollect",
						contentType : "application/x-www-form-urlencoded",
						data:{
							"stu_id":param,
							"aca_id":aca_id
						},
						success:function(data){alert(data.message)},
						error:function(data){alert(data.message)}
					});
				})
				
			}
		
		function jump(aca_id){
				var academy_card = $("div[aca_id='"+ aca_id +"']");
				var aid = "a" + aca_id;
				var academy_card_a = $("a[aid='"+ aid +"']");
				href = academy_card_a.attr("href");

				window.location.href=href;
			}
	</script>
</html>